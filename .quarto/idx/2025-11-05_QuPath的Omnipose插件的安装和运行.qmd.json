{"title":"QuPathçš„Omnipose","markdown":{"yaml":{"title":"QuPathçš„Omnipose","subtitle":"QuPathçš„Omniposeæ’ä»¶çš„å®‰è£…å’Œè¿è¡Œ","date":"2025-11-05","toc-depth":4,"toc-expand":true,"lang":"en"},"headingText":"1. å®‰è£…Omnipose","containsRefs":false,"markdown":"\n\nç›¸å¯¹æ¥è¯´ï¼Œèƒ½æˆåŠŸçš„å®‰è£…Omnipose [@Cutler2022]ï¼ˆæˆ–è€…åŒ…æ‹¬Cellpose [@Pachitariu2025]ï¼‰è½¯ä»¶ï¼Œå¹¶æˆåŠŸçš„å®‰è£…å’Œè¿è¡Œå¯¹åº”QuPahæ’ä»¶ï¼Œç›¸å¯¹å›°éš¾äº›ã€‚\n\nè¿™é‡Œå±•ç¤ºåœ¨Windows 11 64ä½æ“ä½œç³»ç»Ÿçš„å®‰è£…è¿‡ç¨‹ã€‚\n\n\nå‡è®¾å·²ç»å®‰è£…å¥½äº†minicondaï¼ˆæœ¬æœºå®‰è£…çš„ç‰ˆæœ¬æ˜¯conda 25.9.1ï¼‰ã€‚\n\nå‚ç…§https://github.com/kevinjohncutler/omniposeå®‰è£…Omniposeã€‚\n\n```\nconda create -n omnipose 'python==3.10.12' pytorch\nconda activate omnipose\ngit clone https://github.com/kevinjohncutler/omnipose.git\ncd omnipose\npip install -e .\n```\n\nå®‰è£…ç»“æŸåï¼Œå¯åŠ¨Omniposeé‡åˆ°é—®é¢˜ğŸ˜¥ï¼š\n\n```\nomnipose\n\nOMP: Error #15: Initializing libiomp5md.dll, but found libiomp5md.dll already initialized.\nOMP: Hint This means that multiple copies of the OpenMP runtime have been linked into the program. That is dangerous, since it can degrade performance or cause incorrect results. The best thing to do is to ensure that only a single OpenMP runtime is linked into the process, e.g. by avoiding static linking of the OpenMP runtime in any library. As an unsafe, unsupported, undocumented workaround you can set the environment variable KMP_DUPLICATE_LIB_OK=TRUE to allow the program to continue to execute, but that may cause crashes or silently produce incorrect results. For more information, please see http://www.intel.com/software/products/support/.\n```\n\né‡åˆ°äº†OpenMP and libiomp5ç›¸å…³é—®é¢˜ï¼Œå‚è€ƒhttps://omnipose.readthedocs.io/installation.htmlï¼Œè¿è¡Œï¼š\n\n```\nconda install nomkl\n```\n\nå†æ¬¡å¯åŠ¨Omniposeï¼Œåˆé‡åˆ°é—®é¢˜ğŸ˜¥ï¼š\n\n```\nomnipose\n\nTraceback (most recent call last):\n  File \"C:\\ProgramData\\miniconda3\\envs\\omnipose\\lib\\runpy.py\", line 196, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n  File \"C:\\ProgramData\\miniconda3\\envs\\omnipose\\lib\\runpy.py\", line 86, in _run_code\n    exec(code, run_globals)\n  File \"C:\\ProgramData\\miniconda3\\envs\\omnipose\\Scripts\\omnipose.exe\\__main__.py\", line 2, in <module>\n  File \"D:\\8_tak\\36_Omnipose-study_2025-10-31\\omnipose\\src\\omnipose\\__init__.py\", line 15, in <module>\n    from numba.core.errors import NumbaPendingDeprecationWarning\n  File \"C:\\ProgramData\\miniconda3\\envs\\omnipose\\lib\\site-packages\\numba\\__init__.py\", line 59, in <module>\n    _ensure_critical_deps()\n  File \"C:\\ProgramData\\miniconda3\\envs\\omnipose\\lib\\site-packages\\numba\\__init__.py\", line 34, in _ensure_critical_deps\n    import numpy as np\nModuleNotFoundError: No module named 'numpy'\n```\n\nå› æ­¤ï¼š\n\n```\npip install numpy\n```\n\nå®‰è£…çš„numpyç‰ˆæœ¬ä¸ºv2.2.6ã€‚\n\nè¿™æ—¶ï¼Œå¯ä»¥æˆåŠŸçš„å¯åŠ¨Omniposeäº†ğŸ¥³ã€‚\n\n<center>\n![](images/omnipose_screenshot.png){width=\"100%\"}\n</center>\n\n## 2. å®‰è£…QuPathçš„Omniposeæ’ä»¶\n\nå‚è€ƒhttps://github.com/BIOP/qupath-extension-cellposeå®‰è£…Omniposeæ’ä»¶å¹¶è®¾ç½®å¯¹åº”ç¯å¢ƒPythonçš„è·¯å¾„ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚\n\nè¿è¡Œæ’ä»¶æä¾›çš„è„šæœ¬ï¼ˆè®¤çœŸé˜…è¯»è„šæœ¬çš„æ³¨é‡Šï¼Œå¹¶æ ¹æ®éœ€è¦å»ä¿®æ”¹ï¼‰æ—¶ï¼ŒæŠ¥é”™ï¼ˆä¸‹é¢æ˜¯éƒ¨åˆ†æŠ¥é”™ä¿¡æ¯ï¼‰ğŸ˜¥ï¼š\n\n```\nINFO: Cellpose2D: AttributeError: `newbyteorder` was removed from the ndarray class in NumPy 2.0. Use `arr.view(arr.dtype.newbyteorder(order))` instead.\nINFO: Reading Temp_0_0_z0_t0_cp_masks.tif\nERROR: Cannot invoke \"ij.ImagePlus.getProcessor()\" because \"label_imp\" is null\n```\n\nå› æ­¤ï¼š\n\n```\nconda activate omnipose\npip install \"numpy<2.0\"\n```\n\nå®‰è£…çš„numpyç‰ˆæœ¬é™ä½ä¸ºv1.26.4ï¼ˆç¬¬1éƒ¨åˆ†å®‰è£…çš„æ˜¯v2.2.6ï¼‰ã€‚\n\nè¿™æ—¶ï¼Œå¯ä»¥æˆåŠŸçš„è¿è¡ŒOmniposeæ’ä»¶äº†ğŸ¥³ã€‚\n\n<center>\n![](images/qupath_omnipose_screenshot.png){width=\"100%\"}\n</center>\n\n\nè¡¥å……è¯´æ˜ï¼šè„šæœ¬ä¸­çš„modelç”¨ç»å¯¹è·¯å¾„å»å®šä½ï¼Œæ¯”å¦‚ï¼š\n\n```\ndef pathModel = \"C:\\\\Users\\\\æˆ‘\\\\.cellpose\\\\models\\\\bact_phase_affinitytorch_0\"\n```\n\nä»¥é˜²å‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š\n\n```\nERROR: Cannot invoke \"ij.ImagePlus.getProcessor()\" because \"label_imp\" is null\n```\n\n[ç»™æˆ‘ä¹°æ¯èŒ¶ğŸµ](ç»™æˆ‘ä¹°æ¯èŒ¶.qmd)\n\n## References","srcMarkdownNoYaml":"\n\nç›¸å¯¹æ¥è¯´ï¼Œèƒ½æˆåŠŸçš„å®‰è£…Omnipose [@Cutler2022]ï¼ˆæˆ–è€…åŒ…æ‹¬Cellpose [@Pachitariu2025]ï¼‰è½¯ä»¶ï¼Œå¹¶æˆåŠŸçš„å®‰è£…å’Œè¿è¡Œå¯¹åº”QuPahæ’ä»¶ï¼Œç›¸å¯¹å›°éš¾äº›ã€‚\n\nè¿™é‡Œå±•ç¤ºåœ¨Windows 11 64ä½æ“ä½œç³»ç»Ÿçš„å®‰è£…è¿‡ç¨‹ã€‚\n\n## 1. å®‰è£…Omnipose\n\nå‡è®¾å·²ç»å®‰è£…å¥½äº†minicondaï¼ˆæœ¬æœºå®‰è£…çš„ç‰ˆæœ¬æ˜¯conda 25.9.1ï¼‰ã€‚\n\nå‚ç…§https://github.com/kevinjohncutler/omniposeå®‰è£…Omniposeã€‚\n\n```\nconda create -n omnipose 'python==3.10.12' pytorch\nconda activate omnipose\ngit clone https://github.com/kevinjohncutler/omnipose.git\ncd omnipose\npip install -e .\n```\n\nå®‰è£…ç»“æŸåï¼Œå¯åŠ¨Omniposeé‡åˆ°é—®é¢˜ğŸ˜¥ï¼š\n\n```\nomnipose\n\nOMP: Error #15: Initializing libiomp5md.dll, but found libiomp5md.dll already initialized.\nOMP: Hint This means that multiple copies of the OpenMP runtime have been linked into the program. That is dangerous, since it can degrade performance or cause incorrect results. The best thing to do is to ensure that only a single OpenMP runtime is linked into the process, e.g. by avoiding static linking of the OpenMP runtime in any library. As an unsafe, unsupported, undocumented workaround you can set the environment variable KMP_DUPLICATE_LIB_OK=TRUE to allow the program to continue to execute, but that may cause crashes or silently produce incorrect results. For more information, please see http://www.intel.com/software/products/support/.\n```\n\né‡åˆ°äº†OpenMP and libiomp5ç›¸å…³é—®é¢˜ï¼Œå‚è€ƒhttps://omnipose.readthedocs.io/installation.htmlï¼Œè¿è¡Œï¼š\n\n```\nconda install nomkl\n```\n\nå†æ¬¡å¯åŠ¨Omniposeï¼Œåˆé‡åˆ°é—®é¢˜ğŸ˜¥ï¼š\n\n```\nomnipose\n\nTraceback (most recent call last):\n  File \"C:\\ProgramData\\miniconda3\\envs\\omnipose\\lib\\runpy.py\", line 196, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n  File \"C:\\ProgramData\\miniconda3\\envs\\omnipose\\lib\\runpy.py\", line 86, in _run_code\n    exec(code, run_globals)\n  File \"C:\\ProgramData\\miniconda3\\envs\\omnipose\\Scripts\\omnipose.exe\\__main__.py\", line 2, in <module>\n  File \"D:\\8_tak\\36_Omnipose-study_2025-10-31\\omnipose\\src\\omnipose\\__init__.py\", line 15, in <module>\n    from numba.core.errors import NumbaPendingDeprecationWarning\n  File \"C:\\ProgramData\\miniconda3\\envs\\omnipose\\lib\\site-packages\\numba\\__init__.py\", line 59, in <module>\n    _ensure_critical_deps()\n  File \"C:\\ProgramData\\miniconda3\\envs\\omnipose\\lib\\site-packages\\numba\\__init__.py\", line 34, in _ensure_critical_deps\n    import numpy as np\nModuleNotFoundError: No module named 'numpy'\n```\n\nå› æ­¤ï¼š\n\n```\npip install numpy\n```\n\nå®‰è£…çš„numpyç‰ˆæœ¬ä¸ºv2.2.6ã€‚\n\nè¿™æ—¶ï¼Œå¯ä»¥æˆåŠŸçš„å¯åŠ¨Omniposeäº†ğŸ¥³ã€‚\n\n<center>\n![](images/omnipose_screenshot.png){width=\"100%\"}\n</center>\n\n## 2. å®‰è£…QuPathçš„Omniposeæ’ä»¶\n\nå‚è€ƒhttps://github.com/BIOP/qupath-extension-cellposeå®‰è£…Omniposeæ’ä»¶å¹¶è®¾ç½®å¯¹åº”ç¯å¢ƒPythonçš„è·¯å¾„ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚\n\nè¿è¡Œæ’ä»¶æä¾›çš„è„šæœ¬ï¼ˆè®¤çœŸé˜…è¯»è„šæœ¬çš„æ³¨é‡Šï¼Œå¹¶æ ¹æ®éœ€è¦å»ä¿®æ”¹ï¼‰æ—¶ï¼ŒæŠ¥é”™ï¼ˆä¸‹é¢æ˜¯éƒ¨åˆ†æŠ¥é”™ä¿¡æ¯ï¼‰ğŸ˜¥ï¼š\n\n```\nINFO: Cellpose2D: AttributeError: `newbyteorder` was removed from the ndarray class in NumPy 2.0. Use `arr.view(arr.dtype.newbyteorder(order))` instead.\nINFO: Reading Temp_0_0_z0_t0_cp_masks.tif\nERROR: Cannot invoke \"ij.ImagePlus.getProcessor()\" because \"label_imp\" is null\n```\n\nå› æ­¤ï¼š\n\n```\nconda activate omnipose\npip install \"numpy<2.0\"\n```\n\nå®‰è£…çš„numpyç‰ˆæœ¬é™ä½ä¸ºv1.26.4ï¼ˆç¬¬1éƒ¨åˆ†å®‰è£…çš„æ˜¯v2.2.6ï¼‰ã€‚\n\nè¿™æ—¶ï¼Œå¯ä»¥æˆåŠŸçš„è¿è¡ŒOmniposeæ’ä»¶äº†ğŸ¥³ã€‚\n\n<center>\n![](images/qupath_omnipose_screenshot.png){width=\"100%\"}\n</center>\n\n\nè¡¥å……è¯´æ˜ï¼šè„šæœ¬ä¸­çš„modelç”¨ç»å¯¹è·¯å¾„å»å®šä½ï¼Œæ¯”å¦‚ï¼š\n\n```\ndef pathModel = \"C:\\\\Users\\\\æˆ‘\\\\.cellpose\\\\models\\\\bact_phase_affinitytorch_0\"\n```\n\nä»¥é˜²å‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š\n\n```\nERROR: Cannot invoke \"ij.ImagePlus.getProcessor()\" because \"label_imp\" is null\n```\n\n[ç»™æˆ‘ä¹°æ¯èŒ¶ğŸµ](ç»™æˆ‘ä¹°æ¯èŒ¶.qmd)\n\n## References"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"pygments","toc-depth":4,"output-file":"2025-11-05_QuPathçš„Omniposeæ’ä»¶çš„å®‰è£…å’Œè¿è¡Œ.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.8.25","bibliography":["references.bib"],"csl":"science.csl","theme":{"light":"Sandstone","dark":"Solar"},"code-copy":true,"number-depth":1,"title":"QuPathçš„Omnipose","subtitle":"QuPathçš„Omniposeæ’ä»¶çš„å®‰è£…å’Œè¿è¡Œ","date":"2025-11-05","toc-expand":true},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}