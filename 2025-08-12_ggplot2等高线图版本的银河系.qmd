---
title: ggplot2â€œé“¶æ²³ç³»â€
subtitle: ggplot2ç­‰é«˜çº¿å›¾ç‰ˆæœ¬çš„â€œé“¶æ²³ç³»â€
date: 2025-08-12
toc-depth: 4
toc-expand: true
lang: en
---

åœ¨2025-07-29æ—¥ï¼Œæˆ‘ä»¬å±•ç¤ºè¿‡H&Eèµ·æºç‰ˆæœ¬çš„â€œé“¶æ²³ç³»â€ï¼ˆ[QuPathï¼šâ€œé“¶æ²³ç³»â€èµ·æºäºH&E](2025-07-29_é“¶æ²³ç³»èµ·æºäºHE.qmd)ï¼‰ï¼Œç¬”è€…åœ¨è¿™é‡Œå°è¯•é€šè¿‡Rçš„ggplot2ï¼ˆåŒ…æ‹¬ä»£ç /R codesï¼‰æ¥å±•ç¤ºè¯¥â€œé“¶æ²³ç³»â€ã€‚

## 1. åŠ è½½RåŒ…

```{r}
#| message: false
#| warning: false
# load packages
library(tidyverse) # Load the tidyverse package (include ggplot2) for data manipulation and visualization
library(RColorBrewer) # For color palettes
```

## 2. è¯»å–è¡¨æ ¼æ•°æ®å¹¶é€‰æ‹©åæ ‡åˆ—

```{r}
# read the table containing the location of detected objects (i.e. nuclei)
txt_file <- "raw_data/2025-08-12_QuPath_InstanSeg.txt"
df <- txt_file |> read_delim(delim = "\t", col_names = TRUE, show_col_types = FALSE)
```

```{r}
df |> names() # Display the column names

df <- df |> select(`Centroid X Âµm`, `Centroid Y Âµm`) # Select the two columns which correspond to the X and Y coordinates of detected nuclei

df |> head() # Display the first six rows of the data frame
```

## 3. å¢åŠ ä¸€ä¸ªâ€œrandom_colorâ€åˆ—ï¼Œç”¨äºæ¯ä¸ªç»†èƒæ ¸é¢œè‰²çš„éšæœºåˆ†é…

```{r}
palette <- brewer.pal(8, "Set2") # get a color palette

df <- df |> 
  mutate(random_color = sample(palette, nrow(df), replace = TRUE)) # add a random color column

df |> head() # Display the first six rows of the updated data frame
```

## 4. è®¾å®šä¸€ä¸ªä¸ªæ€§åŒ–çš„ä¸»é¢˜ï¼ˆthemeï¼‰

```{r}
# set a custome theme
custom_theme <- theme(
  panel.grid = element_blank(), # remove grid lines
  axis.text = element_blank(), # remove axis text
  axis.title = element_blank(), # remove axis titles
  axis.ticks = element_blank(), # remove axis ticks
  legend.position = "none", # remove legend
  panel.background = element_blank(), # remove panel background
  plot.background = element_blank(), # remove plot background
  plot.margin = margin(0, 0, 0, 0, "cm") # remove plot margins
)
```

## 5. æ˜¾ç¤ºâ€œé“¶æ²³ç³»â€å¯¹åº”çš„ç»†èƒæ ¸åˆ†å¸ƒ

```{r}
ggplot(df, aes(x = `Centroid X Âµm`, y = `Centroid Y Âµm`)) +
  geom_point(aes(color = random_color)) + # scatter plot
  scale_x_continuous(limits = c(0, 896)) + # set x limits
  scale_y_continuous(limits = c(0, 768)) + # set y limits
  custom_theme # apply custom theme
```

## 6. æ˜¾ç¤ºâ€œé“¶æ²³ç³»â€å¯¹åº”çš„ç»†èƒæ ¸åˆ†å¸ƒå’Œç­‰é«˜çº¿å›¾

```{r}
ggplot(df, aes(x = `Centroid X Âµm`, y = `Centroid Y Âµm`)) +
  geom_point(aes(color = random_color)) + # scatter plot
  geom_density_2d_filled(alpha = 0.6) + # add filled contour lines with transparency
  scale_fill_brewer(palette = "YlGn") + # set fill color palette
  scale_x_continuous(limits = c(0, 896)) + # set x limits
  scale_y_continuous(limits = c(0, 768)) + # set y limits
  custom_theme # apply custom theme
```

## 7. â€œé“¶è¡Œç³»â€çš„èµ·æº

<img src="images/he_low.png" style="width: 100%; height: auto;">

[ç»™æˆ‘ä¹°æ¯èŒ¶ğŸµ](ç»™æˆ‘ä¹°æ¯èŒ¶.qmd)