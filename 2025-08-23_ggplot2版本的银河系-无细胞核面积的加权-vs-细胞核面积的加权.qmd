---
title: ggplot2â€œé“¶æ²³ç³»â€åŠ æƒæœ‰æ— 
subtitle: ggplot2ç‰ˆæœ¬çš„â€œé“¶æ²³ç³»â€ï¼šæ— ç»†èƒæ ¸é¢ç§¯çš„åŠ æƒ vs. ç»†èƒæ ¸é¢ç§¯çš„åŠ æƒ
date: 2025-08-23
toc-depth: 4
toc-expand: true
lang: en
---

åœ¨2025-07-29ï¼Œæˆ‘ä»¬å±•ç¤ºè¿‡H&Eèµ·æºç‰ˆæœ¬çš„â€œé“¶æ²³ç³»â€ï¼ˆ[QuPathï¼šâ€œé“¶æ²³ç³»â€èµ·æºäºH&E](2025-07-29_é“¶æ²³ç³»èµ·æºäºHE.qmd)ï¼‰ã€‚åœ¨2025-08-12ï¼Œæˆ‘ä»¬é€šè¿‡Rçš„ggplot2æ¥å±•ç¤ºè¯¥â€œé“¶æ²³ç³»â€ï¼ˆ[Rï¼šggplot2ç­‰é«˜çº¿å›¾ç‰ˆæœ¬çš„â€œé“¶æ²³ç³»â€](2025-08-12_ggplot2ç­‰é«˜çº¿å›¾ç‰ˆæœ¬çš„é“¶æ²³ç³».qmd)ï¼‰ã€‚åœ¨2025-08-15ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥è®¡ç®—ç‰¹å®šç­‰é«˜çº¿çš„é¢ç§¯[Rï¼šggplot2ç‰ˆæœ¬çš„â€œé“¶æ²³ç³»â€ï¼Œå¹¶è®¡ç®—ç‰¹å®šç­‰é«˜çº¿çš„é¢ç§¯](2025-08-15_ggplot2ç‰ˆæœ¬çš„é“¶æ²³ç³»-å¹¶è®¡ç®—ç‰¹å®šç­‰é«˜çº¿çš„é¢ç§¯.qmd)ï¼‰ã€‚åœ¨2025-08-21ï¼Œæˆ‘ä»¬å°†ç­‰é«˜çº¿å±•ç¤ºåœ¨åŸå§‹H&Eå›¾ç‰‡ä¸Šï¼ˆ[Rï¼šggplot2ç‰ˆæœ¬çš„â€œé“¶æ²³ç³»â€ï¼Œå¹¶å°†ç­‰é«˜çº¿å±•ç¤ºåœ¨H&Eå›¾ä¸Š](2025-08-21_ggplot2ç‰ˆæœ¬çš„é“¶æ²³ç³»-å¹¶å°†ç­‰é«˜çº¿å±•ç¤ºåœ¨HEå›¾ä¸Š.qmd)ï¼‰ã€‚

è¿™æ¬¡ï¼Œæˆ‘ä»¬é€šè¿‡ggplot2å±•ç¤ºè¯¥â€œé“¶æ²³ç³»â€ï¼Œä¸”æ¯”è¾ƒæœ‰æ— ç»†èƒæ ¸é¢ç§¯çš„åŠ æƒã€‚

## 1. Load packages and read data/åŠ è½½åŒ…å’Œè¯»å–æ•°æ®

```{r}
#| message: false
#| warning: false
# load packages
library(tidyverse) # for data manipulation and visualization
library(RColorBrewer) # for color palettes
```

```{r}
# read the table
txt_file <- "raw_data/2025-08-12_QuPath_InstanSeg.txt" # specify the path to the text file
df <- txt_file |> read_delim(delim = "\t", col_names = TRUE, show_col_types = FALSE) # read the text file as a data frame
txt_file |> rm() # remove the txt_file variable to free up memory
```

```{r}
df <- df |> 
    dplyr::select(`Centroid X Âµm`, `Centroid Y Âµm`, `Area Âµm^2`) # select the columns specifying the coordinates and area of nuclei
df |> head() # display the first few rows of the data frame
```

## 2. å¢åŠ ä¸€ä¸ªâ€œrandom_colorâ€åˆ—ï¼Œç”¨äºæ¯ä¸ªç»†èƒæ ¸é¢œè‰²çš„éšæœºåˆ†é…

```{r}
palette <- brewer.pal(8, "Set2") # get a color palette

df <- df |> 
  mutate(Random_color = sample(palette, nrow(df), replace = TRUE)) # add a random color column

df |> head() # Display the first six rows of the updated data frame
```

## 3. Plot the nuclei as points and add contour lines/ç»˜åˆ¶æ— ç»†èƒæ ¸é¢ç§¯åŠ æƒçš„åˆ†å¸ƒå›¾å’Œæœ‰ç»†èƒæ ¸é¢ç§¯åŠ æƒçš„åˆ†å¸ƒå›¾

### 3.1 Without weighted area/æ— ç»†èƒæ ¸é¢ç§¯åŠ æƒ

```{r}
nuclei_unweighted <- ggplot(df, aes(x = `Centroid X Âµm`, y = `Centroid Y Âµm`)) +
  geom_point(aes(color = Random_color)) + # scatter plot
  scale_x_continuous(limits = c(0, 1000)) + # set x limits
  scale_y_continuous(limits = c(0, 900)) + # set y limits
  theme_classic() # apply classic theme

nuclei_unweighted

ggsave("images/2025-08-23_without-weighted-area.png", width = 8, height = 6, dpi = 300)
```

### 3.2 With weighted area/æœ‰ç»†èƒæ ¸é¢ç§¯åŠ æƒ

```{r}
nuclei_weighted <- ggplot(df, aes(x = `Centroid X Âµm`, y = `Centroid Y Âµm`)) +
  geom_point(aes(color = Random_color, size = `Area Âµm^2`), alpha = 1/2) + # scatter plot
  scale_size_area("Area\n(Âµm^2)", breaks = c(5, 10, 20, 40, 80, 120, 160)) + # set size scale
  scale_x_continuous(limits = c(0, 1000)) + # set x limits
  scale_y_continuous(limits = c(0, 900)) + # set y limits
  theme_classic() # apply classic theme

nuclei_weighted
```

## 4. â€œé“¶æ²³ç³»â€çš„èµ·æº

<img src="images/he_low.png" style="width: 100%; height: auto">

[ç»™æˆ‘ä¹°æ¯èŒ¶ğŸµ](ç»™æˆ‘ä¹°æ¯èŒ¶.qmd)