---
title: QuPathçš„Omnipose
subtitle: QuPathçš„Omniposeæ’ä»¶çš„å®‰è£…å’Œè¿è¡Œ
date: 2025-11-05
toc-depth: 4
toc-expand: true
lang: en
---

ç›¸å¯¹æ¥è¯´ï¼Œèƒ½æˆåŠŸçš„å®‰è£…Omnipose [@Cutler2022]ï¼ˆæˆ–è€…åŒ…æ‹¬Cellpose [@Pachitariu2025]ï¼‰è½¯ä»¶ï¼Œå¹¶æˆåŠŸçš„å®‰è£…å’Œè¿è¡Œå¯¹åº”QuPahæ’ä»¶ï¼Œç›¸å¯¹å›°éš¾äº›ã€‚

è¿™é‡Œå±•ç¤ºåœ¨Windows 11 64ä½æ“ä½œç³»ç»Ÿçš„å®‰è£…è¿‡ç¨‹ã€‚

## 1. å®‰è£…Omnipose

å‡è®¾å·²ç»å®‰è£…å¥½äº†minicondaï¼ˆæœ¬æœºå®‰è£…çš„ç‰ˆæœ¬æ˜¯conda 25.9.1ï¼‰ã€‚

å‚ç…§https://github.com/kevinjohncutler/omniposeå®‰è£…Omniposeã€‚

```
conda create -n omnipose 'python==3.10.12' pytorch
conda activate omnipose
git clone https://github.com/kevinjohncutler/omnipose.git
cd omnipose
pip install -e .
```

å®‰è£…ç»“æŸåï¼Œå¯åŠ¨Omniposeé‡åˆ°é—®é¢˜ğŸ˜¥ï¼š

```
omnipose

OMP: Error #15: Initializing libiomp5md.dll, but found libiomp5md.dll already initialized.
OMP: Hint This means that multiple copies of the OpenMP runtime have been linked into the program. That is dangerous, since it can degrade performance or cause incorrect results. The best thing to do is to ensure that only a single OpenMP runtime is linked into the process, e.g. by avoiding static linking of the OpenMP runtime in any library. As an unsafe, unsupported, undocumented workaround you can set the environment variable KMP_DUPLICATE_LIB_OK=TRUE to allow the program to continue to execute, but that may cause crashes or silently produce incorrect results. For more information, please see http://www.intel.com/software/products/support/.
```

é‡åˆ°äº†OpenMP and libiomp5ç›¸å…³é—®é¢˜ï¼Œå‚è€ƒhttps://omnipose.readthedocs.io/installation.htmlï¼Œè¿è¡Œï¼š

```
conda install nomkl
```

å†æ¬¡å¯åŠ¨Omniposeï¼Œåˆé‡åˆ°é—®é¢˜ğŸ˜¥ï¼š

```
omnipose

Traceback (most recent call last):
  File "C:\ProgramData\miniconda3\envs\omnipose\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\ProgramData\miniconda3\envs\omnipose\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\ProgramData\miniconda3\envs\omnipose\Scripts\omnipose.exe\__main__.py", line 2, in <module>
  File "D:\8_tak\36_Omnipose-study_2025-10-31\omnipose\src\omnipose\__init__.py", line 15, in <module>
    from numba.core.errors import NumbaPendingDeprecationWarning
  File "C:\ProgramData\miniconda3\envs\omnipose\lib\site-packages\numba\__init__.py", line 59, in <module>
    _ensure_critical_deps()
  File "C:\ProgramData\miniconda3\envs\omnipose\lib\site-packages\numba\__init__.py", line 34, in _ensure_critical_deps
    import numpy as np
ModuleNotFoundError: No module named 'numpy'
```

å› æ­¤ï¼š

```
pip install numpy
```

å®‰è£…çš„numpyç‰ˆæœ¬ä¸ºv2.2.6ã€‚

è¿™æ—¶ï¼Œå¯ä»¥æˆåŠŸçš„å¯åŠ¨Omniposeäº†ğŸ¥³ã€‚

<center>
![](images/omnipose_screenshot.png){width="100%"}
</center>

## 2. å®‰è£…QuPathçš„Omniposeæ’ä»¶

å‚è€ƒhttps://github.com/BIOP/qupath-extension-cellposeå®‰è£…Omniposeæ’ä»¶å¹¶è®¾ç½®å¯¹åº”ç¯å¢ƒPythonçš„è·¯å¾„ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚

è¿è¡Œæ’ä»¶æä¾›çš„è„šæœ¬ï¼ˆè®¤çœŸé˜…è¯»è„šæœ¬çš„æ³¨é‡Šï¼Œå¹¶æ ¹æ®éœ€è¦å»ä¿®æ”¹ï¼‰æ—¶ï¼ŒæŠ¥é”™ï¼ˆä¸‹é¢æ˜¯éƒ¨åˆ†æŠ¥é”™ä¿¡æ¯ï¼‰ğŸ˜¥ï¼š

```
INFO: Cellpose2D: AttributeError: `newbyteorder` was removed from the ndarray class in NumPy 2.0. Use `arr.view(arr.dtype.newbyteorder(order))` instead.
INFO: Reading Temp_0_0_z0_t0_cp_masks.tif
ERROR: Cannot invoke "ij.ImagePlus.getProcessor()" because "label_imp" is null
```

å› æ­¤ï¼š

```
conda activate omnipose
pip install "numpy<2.0"
```

å®‰è£…çš„numpyç‰ˆæœ¬é™ä½ä¸ºv1.26.4ï¼ˆç¬¬1éƒ¨åˆ†å®‰è£…çš„æ˜¯v2.2.6ï¼‰ã€‚

è¿™æ—¶ï¼Œå¯ä»¥æˆåŠŸçš„è¿è¡ŒOmniposeæ’ä»¶äº†ğŸ¥³ã€‚

<center>
![](images/qupath_omnipose_screenshot.png){width="100%"}
</center>


è¡¥å……è¯´æ˜ï¼šè„šæœ¬ä¸­çš„modelç”¨ç»å¯¹è·¯å¾„å»å®šä½ï¼Œæ¯”å¦‚ï¼š

```
def pathModel = "C:\\Users\\æˆ‘\\.cellpose\\models\\bact_phase_affinitytorch_0"
```

ä»¥é˜²å‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š

```
ERROR: Cannot invoke "ij.ImagePlus.getProcessor()" because "label_imp" is null
```

[ç»™æˆ‘ä¹°æ¯èŒ¶ğŸµ](ç»™æˆ‘ä¹°æ¯èŒ¶.qmd)

## References